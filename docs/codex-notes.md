# Codex Notes

Quick pointers to keep changes safe and avoid common pitfalls in this repo.

## Architecture & Routing
- Frontend is Vite + React Router (lazy-loaded routes in `src/App.tsx`). New pages must be added there or they will 404.
- Blog posts are data-driven from `src/data/blogPosts.ts`; some posts render custom components via the `content` key (`front-4-veneers`, `single-tooth-veneers`).
- The veneers hub for 2â€“4 teeth lives at `/veneers/front-teeth-veneers-los-angeles` (`src/pages/FrontTeethVeneers.tsx`). Internal linking widgets prefer this URL over legacy cost blogs.

## Redirects & Fallbacks
- Netlify redirects live in **both** `netlify.toml` and `public/_redirects`; keep them in sync. Use `scripts/redirect-tests` (legacy list + canonical map) plus `node scripts/test-redirects.mjs` to validate.
- Assets must **not** be caught by wildcard redirects. `/assets/*` is explicitly forced to 200 to prevent lazy-loaded chunks (e.g., `Veneers-*.js`) from being redirected to `/veneers/`.
- Static fallbacks are generated via `npm run generate:fallbacks` (also run inside `npm run build`). If you add new routes, consider a fallback HTML under `public/` for crawler friendliness.

## SEO & Sitemap
- Structured data helpers live under `src/components/seo/` and `src/utils/sitemapGenerator.ts`. Add new high-value pages to the static list in `generateSitemapData`.
- `public/sitemap.xml` is generated by `npm run build` (via `scripts/generate-sitemap.js`). Update after adding routes or changing publish flags.

## Testing & Commands
- Primary gates: `npm run lint`, `npm run build`. Optional: `npm run build:prod` (runs image optimization).
- Redirect verification: `node scripts/test-redirects.mjs` (set `REDIRECT_TEST_BASE` if not localhost).
- Browser smoke: `node test-browser.js` against a running server (`npm run dev` or `npm run preview`).

## Content Notes
- Legacy front-teeth cost blogs are unpublished and 301 to the new hub. Do not republish without revisiting redirects and sitemap.
- Internal linking (`src/components/InternalLinkingWidget.tsx`) is context-aware; update priorities when adding new veneers content to keep the hub surfaced.
